<!DOCTYPE html>
<html>

<head>
    <title>Rhizome/Max Communicator: Multi-Sling version</title>
    <script src="js/jquery-2.1.0.min.js"></script>
    <script src="rhizome/rhizome.js"></script>
    <script src="js/lodash.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <script>
        var client; 

        $(function() {//$ is part of jquery. This waits until the page is loaded until it starts running the below
            //code. This lets you wait until the Max patch is opened before we start to our audience's phones.
            
            
            //Starts communication with max
            window.max.outlet('INIT Rhizome', rhizome.Client.isSupported());
            //init rhizome 
            client = new rhizome.Client();
            window.max.outlet('Server Status ', client.status());
         

            // `rhizome.start` is the first function that should be called. This is subscribing to ALL messages.
            // The function inside is executed once the client managed to connect.
            client.start(function(err) {
                window.max.outlet('SoundSling 2D Start Status ', client.status());
                client.send('/sys/subscribe', ['/'])
            });
            

            //Callback functions that run as watchdogs.
            //special websocket client messages 
            client.on('connected', function() {
                window.max.outlet('connected')
            });
            client.on('connection lost', function() {
                window.max.outlet('connection lost')
            });
            client.on('server full', function() {
                window.max.outlet('server full');
            });

          //Any message Rhizome receives
            // Any message you want to respond to

            client.on('message', function(address, args) {
                if (address === '/play') {
                    window.max.outlet('/play', args[0]);//this is where Rhizome passes it to Max, and passes it
                    //OUT of JWeb object.
                }
                
                if (address === '/soundLocationX') {
                    window.max.outlet('/soundLocationX', args.join(" "));
                }
                if (address === '/soundLocationY') {
                    window.max.outlet('/soundLocationY', args.join(" "));
                }

                if(address==='/speakerBleed'){
                    window.max.outlet('/speakerBleed', args);
                }

               

                if (address === '/locationChosen') {
                    window.max.outlet('/locationChosen', args);
                }
            });


  //************ IMPORTANT*************

      //Looking at things you send INTO JWeb object in Max
            // Any max messages you want to respond to:

            // // Example of sending toggle data in
            window.max.bindInlet('play', function(data) {
                window.max.outlet('playing cue!', data);
                 
                     client.send('/play', [data]);
                
             });

            

           

            
            //Easing function movement data - X axis!
             window.max.bindInlet('soundLocationX', function (data) {
                window.max.outlet('Sound Location - X location', data);
                var toSendLoc = data.split(" ");
                window.max.outlet('Sound Location Array', toSendLoc.join(" "));
                window.max.outlet('Server Status ', client.status());
                client.send('/soundLocationX', toSendLoc);
            });
            
             //Easing function movement data - Y axis!
            window.max.bindInlet('soundLocationY', function (data) {
                window.max.outlet('Sound Location - Y location', data);
                var toSendLoc = data.split(" ");
                window.max.outlet('Sound Location Array', toSendLoc.join(" "));
                window.max.outlet('Server Status ', client.status());
                client.send('/soundLocationY', toSendLoc);
            });
             
            //Explain how messages are formated from Max here

            //Speaker Bleed values change to immitate from above
            window.max.bindInlet('speakerBleed', function (data) {
                window.max.outlet('Speaker Bleed', data);
                var toSendBleed = data.split(" ");
                window.max.outlet('Speaker Bleed Array', toSendBleed.join(" "));
                window.max.outlet('Server Status ', client.status());
                client.send('/speakerBleed', toSendBleed);
            });

           
             
        });

       
    </script>


</head>

<body>
<h1>SoundSling</h1>
<h3>Ready to Sling in Two Directions! Check the Max console to see that the server has started.</h3>



</body>

</html>